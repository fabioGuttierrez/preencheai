<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulário de Contrato</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { background: #f0f2ff; min-height: 100vh; padding: 2rem 1rem; font-family: 'Segoe UI', sans-serif; }
    .form-card { background: #fff; border-radius: 16px; padding: 2.5rem; max-width: 560px; margin: 0 auto; box-shadow: 0 8px 32px rgba(79,70,229,.1); border: 1px solid #e0e7ff; }
    .brand { color: #4f46e5; font-weight: 800; font-size: 1.1rem; }
    .btn-primary { background: #4f46e5; border-color: #4f46e5; }
    .btn-primary:hover { background: #4338ca; border-color: #4338ca; }
    .form-control:focus, .form-select:focus { border-color: #818cf8; box-shadow: 0 0 0 .2rem rgba(129,140,248,.25); }
    .success-icon { width: 72px; height: 72px; background: #dcfce7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 2rem; color: #16a34a; }
  </style>
</head>
<body>

<div class="form-card">
  <div class="text-center mb-4">
    <div class="brand mb-1"><i class="bi bi-file-earmark-text-fill me-2"></i>preencheai</div>
    <h5 class="fw-bold mt-3 mb-0">Formulário de Contrato</h5>
    <p class="text-muted small">Olá, <strong>{{ link.cliente.nome }}</strong>! Preencha os dados abaixo.</p>
  </div>

  {% if sucesso %}
  <div class="text-center py-3">
    <div class="success-icon"><i class="bi bi-hourglass-split"></i></div>
    <h5 class="fw-bold">Recebemos seus dados!</h5>
    <p class="text-muted small mb-3">Estamos processando as informações.</p>
    <div class="d-flex align-items-center justify-content-center gap-2 text-muted small">
      <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      Enviaremos o contrato em breve.
    </div>
  </div>

  {% else %}

  {% for message in messages %}
  <div class="alert alert-danger small py-2">{{ message }}</div>
  {% endfor %}

  <form method="post">
    {% csrf_token %}

    {% if campos %}
    {% for campo in campos %}
    <div class="mb-3">
      <label class="form-label fw-semibold small">
        {{ campo.label }}{% if campo.obrigatorio %} *{% endif %}
      </label>

      {% if campo.tipo == "textarea" %}
      <textarea name="{{ campo.placeholder }}" class="form-control" rows="3" {% if campo.obrigatorio %}required{% endif %}></textarea>

      {% elif campo.tipo == "select" %}
      <select name="{{ campo.placeholder }}" class="form-select" {% if campo.obrigatorio %}required{% endif %}>
        <option value="">Selecione</option>
        {% for opcao in campo.opcoes %}
        <option value="{{ opcao }}">{{ opcao }}</option>
        {% endfor %}
      </select>

      {% elif campo.tipo == "multiselect" %}
      <select name="{{ campo.placeholder }}" class="form-select" multiple {% if campo.obrigatorio %}required{% endif %}>
        {% for opcao in campo.opcoes %}
        <option value="{{ opcao }}">{{ opcao }}</option>
        {% endfor %}
      </select>

      {% else %}
      <input
        type="{% if campo.tipo == "email" %}email{% elif campo.tipo == "number" or campo.tipo == "currency" %}text{% elif campo.tipo == "date" %}text{% elif campo.tipo == "datetime" %}text{% elif campo.tipo == "phone" %}text{% else %}text{% endif %}"
        name="{{ campo.placeholder }}"
        class="form-control"
        {% if campo.mascara %}placeholder="{{ campo.mascara }}"{% endif %}
        {% if campo.obrigatorio %}required{% endif %}
      >
      {% endif %}

      {% if campo.ajuda %}
      <div class="form-text">{{ campo.ajuda }}</div>
      {% elif campo.tipo == "currency" %}
      <div class="form-text">Informe apenas numeros; o R$ sera adicionado automaticamente.</div>
      {% endif %}
    </div>
    {% endfor %}
    {% else %}
    <div class="alert alert-warning small">
      Nenhum campo foi configurado para este contrato.
    </div>
    {% endif %}

    <div class="border-top pt-4">
      <p class="text-muted small mb-3">
        <i class="bi bi-lock-fill me-1"></i>
        Seus dados estão seguros e serão usados apenas para a geração do contrato.
      </p>
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" value="1" id="aceiteLgpd" name="aceite_lgpd" required>
        <label class="form-check-label small" for="aceiteLgpd">
          Li e aceito os <a href="/termos/" target="_blank">Termos de Uso</a> e a
          <a href="/privacidade/" target="_blank">Politica de Privacidade</a>.
        </label>
      </div>
      <button type="submit" class="btn btn-primary w-100 fw-semibold py-2">
        <i class="bi bi-file-earmark-check me-2"></i>Gerar Meu Contrato
      </button>
    </div>
  </form>
  {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
