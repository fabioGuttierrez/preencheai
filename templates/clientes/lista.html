{% extends "base.html" %}
{% block title %}Clientes{% endblock %}
{% block page_title %}Clientes{% endblock %}
{% block active_clientes %}active{% endblock %}

{% block topbar_actions %}
<a href="/clientes/novo/" class="btn btn-primary btn-sm">
  <i class="bi bi-plus-lg me-1"></i>Novo Cliente
</a>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header py-3 px-4">
    <form method="get" class="d-flex flex-column flex-sm-row gap-2" style="max-width:360px">
      <input type="text" name="q" value="{{ q }}" class="form-control form-control-sm" placeholder="Buscar por nome ou e-mail…">
      <div class="d-flex gap-2">
        <button class="btn btn-outline-secondary btn-sm"><i class="bi bi-search"></i></button>
        {% if q %}<a href="/clientes/" class="btn btn-outline-danger btn-sm"><i class="bi bi-x"></i></a>{% endif %}
      </div>
    </form>
  </div>
  <div class="card-body p-0">
    {% if clientes %}
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th class="px-4">Nome</th>
            <th class="d-none d-md-table-cell">CPF</th>
            <th class="d-none d-lg-table-cell">E-mail</th>
            <th class="d-none d-xl-table-cell">Telefone</th>
            <th class="d-none d-md-table-cell">Cadastrado</th>
            <th class="text-end"></th>
          </tr>
        </thead>
        <tbody>
        {% for c in clientes %}
        <tr>
          <td class="px-4 fw-semibold">{{ c.nome }}</td>
          <td class="text-muted font-monospace d-none d-md-table-cell">{{ c.cpf }}</td>
          <td class="d-none d-lg-table-cell">{{ c.email }}</td>
          <td class="text-muted d-none d-xl-table-cell">{{ c.telefone|default:"—" }}</td>
          <td class="text-muted small d-none d-md-table-cell">{{ c.criado_em|date:"d/m/Y" }}</td>
          <td class="text-end pe-4">
            <a href="/clientes/{{ c.id }}/editar/" class="btn btn-sm btn-outline-secondary me-1">
              <i class="bi bi-pencil"></i>
            </a>
            <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#del-{{ c.id }}">
              <i class="bi bi-trash"></i>
            </button>

            <div class="modal fade" id="del-{{ c.id }}" tabindex="-1">
              <div class="modal-dialog modal-sm">
                <div class="modal-content">
                  <div class="modal-header border-0">
                    <h6 class="modal-title">Remover cliente?</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body pt-0 text-muted small">
                    Isso removerá <strong>{{ c.nome }}</strong> permanentemente.
                  </div>
                  <div class="modal-footer border-0 pt-0">
                    <button class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form method="post" action="/clientes/{{ c.id }}/deletar/" class="d-inline">
                      {% csrf_token %}
                      <button class="btn btn-sm btn-danger">Remover</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-5 text-muted">
      <i class="bi bi-people fs-2 d-block mb-2"></i>
      {% if q %}Nenhum resultado para "{{ q }}".{% else %}Nenhum cliente cadastrado ainda.{% endif %}
      <a href="/clientes/novo/" class="d-block mt-2">Cadastrar primeiro cliente</a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
