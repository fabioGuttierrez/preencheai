<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}preencheai{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root { --sidebar-width: 240px; --primary: #4f46e5; }
    body { background: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
    .sidebar {
      width: var(--sidebar-width); height: 100vh; position: fixed;
      top: 0; left: 0; background: #1e1b4b; z-index: 100;
      display: flex; flex-direction: column; padding: 0;
    }
    .sidebar-brand {
      padding: 1.25rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,.1);
      color: #fff; font-weight: 700; font-size: 1.1rem; text-decoration: none;
      display: flex; align-items: center; gap: .5rem;
    }
    .sidebar-brand:hover { color: #c7d2fe; }
    .sidebar-nav { padding: 1rem 0; flex: 1; overflow-y: auto; }
    .sidebar-label {
      color: rgba(255,255,255,.4); font-size: .7rem; font-weight: 600;
      letter-spacing: .1em; text-transform: uppercase;
      padding: .5rem 1.5rem .25rem;
    }
    .sidebar-link {
      display: flex; align-items: center; gap: .625rem;
      padding: .5rem 1.5rem; color: rgba(255,255,255,.75);
      text-decoration: none; font-size: .9rem; border-radius: 0;
      transition: all .15s;
    }
    .sidebar-link:hover, .sidebar-link.active {
      background: rgba(255,255,255,.1); color: #fff;
    }
    .sidebar-link.active { border-left: 3px solid #818cf8; }
    .sidebar-footer {
      padding: 1rem 1.5rem; border-top: 1px solid rgba(255,255,255,.1);
      font-size: .8rem; color: rgba(255,255,255,.5);
    }
    .main-content { margin-left: var(--sidebar-width); min-height: 100vh; }
    .topbar {
      background: #fff; border-bottom: 1px solid #e5e7eb;
      padding: .875rem 1.5rem; display: flex; align-items: center;
      justify-content: space-between; position: sticky; top: 0; z-index: 99;
    }
    .sidebar-toggle {
      border: 1px solid #e5e7eb; background: #fff; color: #111827;
      width: 40px; height: 40px; border-radius: 10px;
      display: inline-flex; align-items: center; justify-content: center;
    }
    .topbar-title { font-weight: 600; font-size: 1rem; color: #111827; margin: 0; }
    .content-area { padding: 1.5rem; }
    .stat-card {
      background: #fff; border-radius: 12px; padding: 1.25rem 1.5rem;
      border: 1px solid #e5e7eb; transition: box-shadow .2s;
    }
    .stat-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,.08); }
    .stat-icon {
      width: 48px; height: 48px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center; font-size: 1.4rem;
    }
    .stat-value { font-size: 1.75rem; font-weight: 700; color: #111827; }
    .stat-label { font-size: .8rem; color: #6b7280; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: none; }
    .card-header { background: #fff; border-bottom: 1px solid #e5e7eb; font-weight: 600; }
    .table th { font-size: .75rem; text-transform: uppercase; letter-spacing: .05em; color: #6b7280; }
    .badge-status-ativo { background: #dcfce7; color: #166534; }
    .badge-status-usado { background: #f3f4f6; color: #6b7280; }
    .btn-primary { background: var(--primary); border-color: var(--primary); }
    .btn-primary:hover { background: #4338ca; border-color: #4338ca; }

    @media (max-width: 992px) {
      .sidebar {
        position: fixed; top: 0; left: 0; height: 100vh; width: 260px;
        transform: translateX(-110%); transition: transform .2s ease;
        box-shadow: 8px 0 24px rgba(0,0,0,.2);
      }
      .sidebar.is-open { transform: translateX(0); }
      .sidebar-nav { padding: 1rem 0; }
      .sidebar-link { border-radius: 0; }
      .sidebar-overlay {
        position: fixed; inset: 0; background: rgba(15,23,42,.5);
        opacity: 0; pointer-events: none; transition: opacity .2s ease;
        z-index: 90;
      }
      .sidebar-overlay.is-open { opacity: 1; pointer-events: auto; }
      .main-content { margin-left: 0; }
      .topbar { position: sticky; flex-wrap: wrap; gap: .75rem; }
      .content-area { padding: 1rem; }
    }

    @media (max-width: 576px) {
      .topbar-title { font-size: .95rem; }
    }
  </style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <a href="/app/" class="sidebar-brand">
    <i class="bi bi-file-earmark-text-fill" style="color:#818cf8"></i>
    preencheai
  </a>
  <nav class="sidebar-nav">
    <div class="sidebar-label">Principal</div>
    <a href="/app/" class="sidebar-link {% block active_dashboard %}{% endblock %}">
      <i class="bi bi-grid-1x2"></i> Dashboard
    </a>

    <div class="sidebar-label mt-2">Gestão</div>
    <a href="/clientes/" class="sidebar-link {% block active_clientes %}{% endblock %}">
      <i class="bi bi-people"></i> Clientes
    </a>
    <a href="/modelos/" class="sidebar-link {% block active_modelos %}{% endblock %}">
      <i class="bi bi-file-earmark-word"></i> Modelos
    </a>
    <a href="/contratos/" class="sidebar-link {% block active_contratos %}{% endblock %}">
      <i class="bi bi-file-earmark-check"></i> Contratos
    </a>

    <div class="sidebar-label mt-2">Links</div>
    <a href="/links/" class="sidebar-link {% block active_links %}{% endblock %}">
      <i class="bi bi-link-45deg"></i> Links de Formulário
    </a>
  </nav>
  <div class="sidebar-footer">
    <div class="mb-1" style="color:rgba(255,255,255,.7)">
      <i class="bi bi-building me-1"></i>
      {{ request.user.organizacao.nome|default:"—" }}
    </div>
    <a href="/logout/" class="text-decoration-none" style="color:rgba(255,255,255,.5)">
      <i class="bi bi-box-arrow-left me-1"></i> Sair
    </a>
  </div>
</div>

<div class="sidebar-overlay" id="sidebarOverlay"></div>

<div class="main-content">
  <div class="topbar">
    <h1 class="topbar-title">{% block page_title %}{% endblock %}</h1>
    <div class="d-flex align-items-center gap-3">
      <button class="sidebar-toggle d-lg-none" type="button" id="sidebarToggle" aria-label="Abrir menu">
        <i class="bi bi-list"></i>
      </button>
      {% block topbar_actions %}{% endblock %}
      <span class="text-muted small">{{ request.user.get_full_name|default:request.user.username }}</span>
    </div>
  </div>

  <div class="content-area">
    {% for message in messages %}
    <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}

    {% block content %}{% endblock %}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  (function () {
    var sidebar = document.getElementById("sidebar");
    var overlay = document.getElementById("sidebarOverlay");
    var toggle = document.getElementById("sidebarToggle");
    if (!sidebar || !overlay || !toggle) {
      return;
    }

    function closeMenu() {
      sidebar.classList.remove("is-open");
      overlay.classList.remove("is-open");
    }

    toggle.addEventListener("click", function () {
      sidebar.classList.toggle("is-open");
      overlay.classList.toggle("is-open");
    });

    overlay.addEventListener("click", closeMenu);
  })();
</script>
{% block extra_js %}{% endblock %}
</body>
</html>
